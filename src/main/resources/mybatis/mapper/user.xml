<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.airjnc.user.dao.UserMapper">
  <delete id="delete">
    UPDATE user
    SET deleted_at = now()
    WHERE id = #{id}
      AND deleted_at IS NULL;
  </delete>
  <select id="findById" resultType="UserEntity">
    SELECT id, email, name, gender, phone_number, address, is_active, birthdate, created_at, updated_at, deleted_at
    FROM user
    WHERE id = #{id}
    <if test='status != null and !status.name().equals("ALL")'>
      AND deleted_at IS
      <choose>
        <when test='status.name().equals("ACTIVE")'>NULL</when>
        <when test='status.name().equals("DELETED")'>NOT NULL</when>
      </choose>
    </if>
  </select>
  <select id="findByWhere" resultType="UserEntity">
    SELECT id, email, name, gender, phone_number, address, is_active, birthdate, created_at, updated_at, deleted_at
    FROM user
    <where>
      <if test="email != null">AND email = #{email}</if>
      <if test="phoneNumber != null">AND phone_number = #{phoneNumber}</if>
      <if test="name != null">AND name = #{name}</if>
      <if test="birthDate != null">AND birth_date = #{birthDate}</if>
      <if test='status != null and !status.name().equals("ALL")'>
        AND deleted_at IS
        <choose>
          <when test='status.name().equals("ACTIVE")'>NULL</when>
          <when test='status.name().equals("DELETED")'>NOT NULL</when>
        </choose>
      </if>
    </where>
  </select>
  <insert id="create" keyProperty="id" useGeneratedKeys="true">
    INSERT INTO user (email, password, name, gender)
    VALUES (#{email}, #{password}, #{name}, #{gender});
  </insert>
  <update id="save">
    UPDATE user
    SET email=#{email},
        phone_number=#{phoneNumber},
        password=#{password},
        name=#{name},
        gender=#{gender},
        address=#{address},
        birthdate=#{birthDate},
        is_active=#{isActive},
        created_at=#{createdAt},
        updated_at=#{updatedAt},
        deleted_at=#{deletedAt}
    WHERE id = #{id}
  </update>
</mapper>
