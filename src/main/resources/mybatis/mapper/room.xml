<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.airjnc.room.dao.RoomMapper">
  <resultMap id="findAll" type="com.airjnc.room.dto.response.SimpleRoom">
    <id column="id" property="id"/>
    <result column="title" property="title"/>
    <result column="pricePerNight" property="pricePerNight"/>
    <collection column="id" property="thumbnailList" resultMap="thumbnailMap"/>
  </resultMap>
  <resultMap id="thumbnailMap" type="String">
    <result column="url"/>
  </resultMap>

  <select id="findAllByCategory" resultMap="findAll">
    SELECT r.id, r.title, r.pricePerNight, rp.url
    FROM (SELECT id, title, pricePerNight
          FROM room
          WHERE room_category_id = #{categoryId}
            AND status = #{roomStatus}
          LIMIT #{skip}, #{offset}) r
           LEFT OUTER JOIN room_photo rp on r.id = rp.room_id
  </select>
  <select id="count" resultType="int">
    SELECT COUNT(*)
    FROM room
    WHERE room_category_id = #{categoryId}
      AND status = #{status}
  </select>
</mapper>
